<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <title>Criar Supervisor</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
body { font-family: Arial; padding:20px; }
input, select, button { display:block; margin-top:10px; padding:10px; width:300px; }
button { background:#2563eb; color:white; border:none; cursor:pointer; }
</style>
</head>
<body class="bg-light">

<div class="container mt-4">
    <h2>Cadastrar Supervisor</h2>
    

    <form id="formSupervisor">
        <label class="form-label">Nome</label>
        <input id="nome" class="form-control mb-2" required>

        <label class="form-label">Email</label>
        <input id="email" type="email" class="form-control mb-2" required>

        <label class="form-label">Senha</label>
        <input id="senha" type="password" class="form-control mb-2" required>

        <label class="form-label">Empresa</label>
        <select id="empresa_id" class="form-control mb-3" required></select>

           <button class="btn btn-primary" type="submit">Criar Supervisor</button>
            
    </form>
           

    <div id="msg" class="mt-3"></div>
     <a href="/superadmin/index.html" class="btn btn-secondary mb-3">← Voltar</a>
</div>

<script>
const API = "https://api.all-multiagente.com.br";
const token = localStorage.getItem("token");

if (!token) {
    alert("Sessão expirada. Faça login novamente.");
    window.location.href = "/login.html";
}

// ================================
// CARREGAR EMPRESAS
// ================================
async function carregarEmpresas() {
    const resp = await fetch(`${API}/empresas/listar`, {
        headers: {
            "Authorization": `Bearer ${token}`
        }
    });

    if (!resp.ok) {
        alert("Erro ao carregar empresas");
        return;
    }

    const data = await resp.json();
    const select = document.getElementById("empresa_id");
    select.innerHTML = "";

    data.empresas.forEach(e => {
        select.innerHTML += `<option value="${e.id}">${e.nome}</option>`;
    });
}

// ================================
// CRIAR SUPERVISOR (OPÇÃO B)
// ================================
document.getElementById("formSupervisor").addEventListener("submit", async function (e) {
    e.preventDefault();

    const dados = {
        nome: document.getElementById("nome").value,
        email: document.getElementById("email").value,
        senha: document.getElementById("senha").value,
        empresa_id: document.getElementById("empresa_id").value,
        role: "SUPERVISOR"
    };

    const resp = await fetch(`${API}/usuarios`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": `Bearer ${token}`
        },
        body: JSON.stringify(dados)
    });

    const msg = document.getElementById("msg");

    const result = await resp.json();

    if (resp.ok) {
        msg.className = "text-success";
        msg.innerText = "Supervisor criado com sucesso!";
        document.getElementById("formSupervisor").reset();
    } else {
        msg.className = "text-danger";
        msg.innerText = result.erro || result.error || "Erro ao criar supervisor";
    }
});

carregarEmpresas();
</script>


</body>
</html>
