<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Agentes</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light">
<div class="container mt-4">

<h3>Agentes da Empresa</h3>
<a href="/supervisor/index.html" class="btn btn-secondary mb-3">← Voltar</a>

<table class="table table-striped">
<thead>
<tr>
<th>Nome</th>
<th>Email</th>
<th>Status</th>
<th width="200">Ações</th>
</tr>
</thead>
<tbody id="listaAgentes"></tbody>
</table>

</div>

<script src="/js/auth.js"></script>
<script>
requireRole("SUPERVISOR");
</script>

<script>
const API = "https://api.all-multiagente.com.br";
const token = localStorage.getItem("token");

if (!token) window.location.href = "/login.html";

async function carregarAgentes() {
    const res = await fetch(`${API}/usuarios/agentes`, {
        headers: { "Authorization": "Bearer " + token }
    });

    if (!res.ok) {
        const err = await res.json();
        alert("Erro: " + (err.erro || res.status));
        return;
    }

    const data = await res.json();
    const tbody = document.getElementById("listaAgentes");
    tbody.innerHTML = "";

    data.agentes.forEach(a => {
        tbody.innerHTML += `
        <tr>
            <td>${a.nome}</td>
            <td>${a.email}</td>
            <td>${a.status || "ATIVO"}</td>
            <td>
                <button class="btn btn-sm btn-warning"
                    onclick="editarAgente(${a.id})">Editar</button>
                <button class="btn btn-sm btn-danger"
                    onclick="excluirAgente(${a.id})">Excluir</button>
            </td>
        </tr>`;
    });
}


async function excluirAgente(id) {
    if (!confirm("Deseja excluir este agente?")) return;

    const res = await fetch(`${API}/usuarios/${id}`, {
        method: "DELETE",
        headers: { "Authorization": "Bearer " + token }
    });

    if (res.ok) carregarAgentes();
    else alert("Erro ao excluir agente");
}

function editarAgente(id) {
    window.location.href = `/supervisor/editar_agente.html?id=${id}`;
}

carregarAgentes();
</script>

</body>
</html>

